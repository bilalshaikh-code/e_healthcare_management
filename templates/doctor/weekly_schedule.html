{% extends "doctor/base.html" %}
{% load static %}

{% block title %}Set Weekly Schedule - HealthPlus{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white text-center">
                    <h3 class="mb-0">
                        Set Your Weekly Availability
                    </h3>
                    <small>One-time setup → Auto-creates your slots forever</small>
                </div>
                <div class="card-body p-4">

                    <!-- Success message if any -->
                    {% if messages %}
                        {% for message in messages %}
                        <div class="alert alert-success alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                    {% endif %}

                    <form method="post">
                        {% csrf_token %}

                        <!-- Working Days -->
                        <div class="mb-4">
                            <label class="form-label fw-bold fs-5 text-primary">
                                Select Your Working Days
                            </label>
                            <div class="row">
                                {% for day in days %}
                                <div class="col-md-4 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               name="days" value="{{ day }}" id="day-{{ day }}"
                                               {% if day in selected_days %}checked{% endif %}>
                                        <label class="form-check-label fw-medium" for="day-{{ day }}">
                                            {{ day|title }}
                                        </label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <hr>

                        <!-- Time Slots -->
                        <div class="mb-4">
                            <label class="form-label fw-bold fs-5 text-primary">
                                Select Your Time Slots
                                <small class="text-muted">(Hold Ctrl/Cmd to select multiple)</small>
                            </label>
                            <select name="slots" multiple class="form-control" size="12" required 
                                    style="height: 380px; font-size: 1rem;">
                                {% for slot in slots %}
                                    <option value="{{ slot.id }}"
                                            {% if slot.id in selected_slots %}selected{% endif %}>
                                        {{ slot.slot_time }}
                                    </option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">
                                Currently selected: <strong>{{ selected_slots|length }} slot(s)</strong>
                            </small>
                        </div>

                        <!-- Current Schedule Preview (if exists) -->
                        {% if current_rules.exists %}
                        <div class="alert alert-info">
                            <strong>Your current weekly schedule:</strong><br>
                            {% for rule in current_rules %}
                                {{ rule.get_day_of_week_display }} -> {{ rule.slot.slot_time }}<br>
                            {% endfor %}
                            <hr>
                            <small class="text-muted">Saving again will replace your current schedule.</small>
                        </div>
                        {% endif %}

                        <div class="text-center">
                            <button type="submit" class="btn btn-success btn-lg px-5">
                                Save Weekly Schedule
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Help Box -->
            <div class="mt-4 p-4 bg-light rounded border">
                <h5>How it works:</h5>
                <ul class="mb-0">
                    <li>You set your schedule once (e.g., Mon, Wed, Fri → 10 AM-1 PM)</li>
                    <li>System auto-creates your slots for next 60+ days</li>
                    <li>Take leave anytime → blocks entire day automatically</li>
                    <li>No daily work needed!</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}